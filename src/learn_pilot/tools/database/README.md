# 📚 论文数据库查看器 CLI v2.0

> 智能论文管理系统的数据库查看和管理工具

## 🎯 功能特点

### 📊 **数据概览**
- 实时数据库统计信息
- 论文处理状态分析
- 研究领域分布统计

### 🔍 **智能搜索**
- 全文搜索（标题+摘要）
- 按研究领域筛选
- 高级过滤条件

### 📄 **数据展示**
- 美观的表格化显示
- 详细的论文信息
- 分页浏览支持

### 🛠️ **数据管理**
- JSON格式数据导出
- 数据库清理工具
- 批量操作支持
- **🗑️ 完全重置功能**

---

## 🚀 快速开始

### 安装依赖

```bash
pip install tabulate  # 如果还没安装的话
```

### 启动方式

#### 方式1: 使用模块启动
```bash
# 使用默认数据库
python -m common_tools.db_app

# 指定数据库文件
python -m common_tools.db_app --db /path/to/your/papers.db
```

#### 方式2: 直接运行
```bash
cd common_tools/db_app
python cli_app.py --db custom.db
```


#### 方式3: 程序化调用
```python
from common_tools.db_app import run_cli

# 使用默认数据库
run_cli()

# 使用自定义数据库
run_cli("/path/to/custom.db")
```

---

## 🗑️ 数据库完全清理工具

⚠️ **危险功能警告：此工具会永久删除所有数据！**

### 功能说明
- 🗄️ 清空数据库中的所有论文记录
- 📁 删除所有已下载的 PDF 文件
- 🔄 重置数据库到初始状态
- 🛡️ 多重安全确认机制

### 使用方法

#### 方式1: 独立运行
```bash
# 交互式清理（推荐）
cd common_tools/db_app
python cleanup_all.py

# 仅查看当前状态
python cleanup_all.py --status-only

# 使用自定义数据库
python cleanup_all.py --db /path/to/custom.db

# 强制清理（跳过确认，危险！）
python cleanup_all.py --force
```

#### 方式2: 程序化调用
```python
from common_tools.db_app import DatabaseCleaner
import asyncio

async def reset_database():
    cleaner = DatabaseCleaner()
    
    # 获取当前状态
    status = cleaner.get_current_status()
    cleaner.display_status(status)
    
    # 执行清理
    success = await cleaner.cleanup_all()
    return success

# 运行清理
asyncio.run(reset_database())
```

### 安全确认流程
清理工具采用三重确认机制防止误操作：

```
⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️
🚨 危险操作警告 🚨
⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️
此操作将会 永久删除 以下数据：
  • 127 条论文记录
  • 数据库文件 (548.0 KB)
  • 89 个下载文件
  • 总计 125.4 MB 数据

❌ 此操作 无法撤销！所有数据将永久丢失！
⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️ ⚠️

请输入以下确认信息：
1️⃣ 输入 'YES' 确认要删除所有数据: 
2️⃣ 输入 'DELETE' 确认理解数据无法恢复: 
3️⃣ 输入当前时间 '1445' 进行最终确认: 
```

### 清理过程展示
```
🧹 论文数据库完全清理工具
==================================================

======================================================================
📊 当前数据状态
======================================================================
🗄️  数据库文件: user_data/Bin/papers.db
📄 论文记录数: 127
💾 数据库大小: 548.0 KB

📁 下载文件目录: user_data/Bin/ai_recommend
📄 下载文件数: 89
💾 文件总大小: 125.4 MB
======================================================================

🚀 开始清理操作...

1️⃣ 正在清空数据库...
   ✅ 成功清空数据库，删除了 127 条记录

2️⃣ 正在清空下载文件...
   ✅ 成功删除 89 个文件，释放空间 125.4 MB

==================================================
🎉 清理操作完成！所有数据已成功删除
💡 提示：现在可以重新开始收集论文数据
==================================================
```

---

## 📋 功能菜单

### 主界面
```
======================================================================
📚 论文数据库查看器 CLI v2.0
======================================================================
1️⃣  查看数据库统计
2️⃣  列出最近论文
3️⃣  搜索论文
4️⃣  按领域查看
5️⃣  查看论文详情
6️⃣  列出所有领域
7️⃣  导出数据
8️⃣  数据库清理
9️⃣  分页浏览
🗑️  完全重置数据库 (新功能)
0️⃣  退出程序
----------------------------------------------------------------------
```

### 1️⃣ 数据库统计
显示完整的数据库概览信息：
- 📚 论文总数
- ✅ 已处理论文数
- 🔍 研究领域数量
- 📅 最近添加时间
- 📈 处理成功率

### 2️⃣ 列出最近论文
以表格形式显示最新的论文：
```
┌────┬────────────────────────────────────────────────────┬─────────────────┬────────┬────────────┐
│ ID │ Title                                              │ Fields          │ Status │ Date       │
├────┼────────────────────────────────────────────────────┼─────────────────┼────────┼────────────┤
│ 42 │ Attention is All You Need                          │ LLM, mLLM       │ ✅     │ 2025-06-28 │
│ 41 │ BERT: Pre-training of Deep Bidirectional...       │ LLM             │ ✅     │ 2025-06-28 │
└────┴────────────────────────────────────────────────────┴─────────────────┴────────┴────────────┘
```

### 3️⃣ 搜索论文
支持关键词搜索：
- 搜索范围：标题 + 摘要
- 实时结果显示
- 支持部分匹配

### 4️⃣ 按领域查看
先显示所有研究领域：
```
🏷️ 所有研究领域:
    1. LLM                  (45 篇)
    2. mLLM                 (23 篇)
    3. AI-Agent             (18 篇)
    4. Group Intelligence   (12 篇)
```

然后按编号选择查看对应领域的论文。

### 5️⃣ 论文详情
显示论文的完整信息：
```
================================================================================
📄 论文详情
================================================================================
🆔 ID: 42
📝 标题: Attention is All You Need
📅 添加日期: 2025-06-28
📊 置信度: 0.95
🏷️ 存储类型: arxiv_recommend
✅ 处理状态: 已处理
🔬 研究领域: LLM, mLLM
🔗 URL: https://arxiv.org/abs/1706.03762
📁 PDF路径: /path/to/1706.03762.pdf

📋 摘要:
   We propose the Transformer, a novel neural network architecture based...
   solely on attention mechanisms, dispensing with recurrence and...
================================================================================
```

### 7️⃣ 数据导出
支持导出为JSON格式：
- 自动生成文件名（带时间戳）
- 自定义文件名
- 包含完整论文数据

### 8️⃣ 数据库清理
清理未处理的论文记录：
- 安全确认机制
- 显示清理数量
- 不可逆操作警告

### 9️⃣ 分页浏览
交互式分页浏览：
- **[n]** 下一页
- **[p]** 上一页  
- **[d]** 查看详情
- **[q]** 退出浏览

### 🗑️ 完全重置数据库 (新功能)
⚠️ **最危险的功能 - 永久删除所有数据**：
- 清空数据库中的所有论文记录
- 删除所有已下载的 PDF 文件
- 重置系统到初始状态
- 三重安全确认机制
- 无法撤销的操作

---

## 🔧 高级用法

### 程序化集成

```python
from common_tools.db_app import PaperDBViewer
import asyncio

async def main():
    viewer = PaperDBViewer()
    
    # 获取统计信息
    stats = await viewer.show_stats()
    
    # 搜索论文
    papers = await viewer.search_papers("transformer")
    
    # 按领域查看
    llm_papers = await viewer.show_papers_by_field("LLM")
    
    # 导出数据
    backup_file = await viewer.export_data("my_papers.json")

asyncio.run(main())
```

### 批处理脚本

```python
# 自动化数据分析脚本
from common_tools.db_app import PaperDBViewer
import asyncio

async def analyze_database():
    viewer = PaperDBViewer()
    
    print("=== 数据库分析报告 ===")
    
    # 1. 基本统计
    stats = await viewer.show_stats()
    
    # 2. 领域分析
    fields = await viewer.list_fields()
    
    # 3. 导出报告
    await viewer.export_data(f"analysis_report_{datetime.now():%Y%m%d}.json")

if __name__ == "__main__":
    asyncio.run(analyze_database())
```

### 数据库重置脚本

```python
# 自动化重置脚本（小心使用！）
from common_tools.db_app import DatabaseCleaner
import asyncio

async def emergency_reset():
    """紧急重置数据库（自动化脚本中使用）"""
    cleaner = DatabaseCleaner()
    
    # 获取状态
    status = cleaner.get_current_status()
    print(f"即将删除 {status['paper_count']} 条记录和 {status['download_files_count']} 个文件")
    
    # 强制执行（跳过交互确认）
    success = await cleaner.cleanup_all(force=True)
    
    if success:
        print("✅ 数据库重置完成")
    else:
        print("❌ 重置失败")
    
    return success

# 谨慎使用！
# asyncio.run(emergency_reset())
```

---

## 🎨 界面展示

### 启动界面
```
======================================================================
📚 论文数据库查看器 v2.0
======================================================================
🗄️ 使用默认数据库路径
🚀 启动论文数据库查看器...

============================================================
📊 数据库统计信息
============================================================
📚 论文总数: 127
✅ 已处理论文: 89
🔍 研究领域数: 12
📅 最近添加: 2025-06-28 15:30:45
📈 处理成功率: 70.1%
============================================================
```

### 搜索结果
```
🔍 搜索结果: 找到 8 篇论文

┌────┬──────────────────────────────────────────────────────────────┬─────────────┬────────┐
│ ID │ Title                                                        │ Fields      │ Status │
├────┼──────────────────────────────────────────────────────────────┼─────────────┼────────┤
│ 45 │ Transformer-XL: Attentive Language Models Beyond a Fixed... │ LLM         │ ✅     │
│ 32 │ BERT: Pre-training of Deep Bidirectional Transformers...   │ LLM         │ ✅     │
└────┴──────────────────────────────────────────────────────────────┴─────────────┴────────┘
```

---

## ⚡ 性能特点

- **异步操作**: 所有数据库操作都是异步的，响应迅速
- **内存优化**: 分页加载，避免大量数据占用内存
- **用户友好**: 直观的表格显示和交互式操作
- **错误处理**: 完善的异常处理和用户提示
- **安全机制**: 危险操作的多重确认保护

---

## 🛠️ 故障排除

### 常见问题

**Q: 显示 "暂无论文数据"**
A: 检查数据库路径是否正确，或者运行论文监控程序添加数据

**Q: 搜索无结果**
A: 尝试使用更通用的关键词，搜索是大小写敏感的

**Q: 导出失败**
A: 检查目标目录的写入权限

**Q: 清理脚本无法运行**
A: 确保有足够的文件系统权限，检查数据库文件是否被其他程序占用

**Q: 意外删除了所有数据**
A: 清理操作是不可逆的，请检查是否有数据备份文件

### 调试模式

设置环境变量启用详细日志：
```bash
export LOG_LEVEL=DEBUG
python -m common_tools.db_app
```

### 数据恢复

如果意外清理了数据库，可以尝试：
1. 检查是否有自动备份文件 (`backup_*.json`)
2. 从导出的 JSON 文件恢复数据
3. 重新运行论文收集程序

---

## 📝 更新日志

### v2.1 (2025-06-28)
- ✅ 新增完全重置数据库功能
- ✅ 三重安全确认机制
- ✅ 智能文件大小显示
- ✅ 详细的清理状态报告
- ✅ 支持强制清理模式
- ✅ 程序化清理接口

### v2.0 (2025-06-28)
- ✅ 全新的CLI界面设计
- ✅ 异步数据库操作
- ✅ 分页浏览功能
- ✅ 智能搜索和筛选
- ✅ 数据导出和清理工具
- ✅ 美观的表格显示

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进这个工具！

**维护者**: bin.liang  
**版本**: v2.1  
**最后更新**: 2025-06-28 